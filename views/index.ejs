<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Corona</title>

    <!-- Custom fonts for this template-->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/site.css" />
    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.css" rel="stylesheet">
    
</head>
<link rel='shortcut icon' type='image/x-icon' href='img/favicon.ico' />
<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">
        <!-- Sidebar -->
        <div class="d-none d-sm-block">
            <ul class="navbar-nav  bg-gradient-primary sidebar sidebar-dark accordion" data-target="mobile-demo" id="accordionSidebar">
                <iframe src="https://cdn.plus500.com/Media/Banners/120x600/37170/index.html?set=Vix_new&language=EN&country=GB&url=https%3A%2F%2Fwww.plus500.co.uk%2F%3Fid%3D125068%26pl%3D2" width="120" height="600" scrolling="no" frameborder="0" style="border:none"></iframe>

            </ul>
        </div>
        <!-- End of Sidebar -->

        <div id="content-wrapper" class="d-flex flex-column">
            <div id="content">
                <div class="container-fluid">
                    <div class="d-sm-flex  align-items-center justify-content-center mb-6">
                        <div class="d-flex p-2 align-items-center  h1 mb-1 mt-2 text-gray-800 font-weight-bold">Corona Virus Near Me</div>
                    </div>
                    <!-- Content Row -->
                    <div class="row">

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-6 col-md-6 mb-6">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body align-items-center d-flex justify-content-center">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Confirmed Cases</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                <%- summary_confirmed %>
                                                <i id="confirmedfasfa-angle" class="fas fa-angle-double-up">  </i> <%- summary_change_con %>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Earnings (Monthly) Card Example -->
                        <div class="col-xl-6 col-md-6 mb-6">
                            <div class="card border-left-danger shadow h-100 py-2">
                                <div class="card-body align-items-center d-flex justify-content-center">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Deaths</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                                <%- summary_deaths %>
                                                <i class="fas fa-angle-double-up"></i>  <%- summary_change_de %>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-12 col-md-12 col-mb-12 col-l-12">
                            <div class="card  shadow h-100 py-2">
                                <div class="card-body align-items-center d-flex justify-content-center">
                                    <div class="row no-gutters align-items-center">
                                        <h4 class="m-0 font-weight-bold text-primary" id="locdatadiv"></h4>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="col-xl-12 col-lg-12 col-sm-12 col-md-12">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h4 class="m-0 font-weight-bold text-primary">Map</h4>
                                    <div class="dropdown no-arrow">
                                    </div>
                                </div>

                                <!-- Card Body -->
                                <div class="card-body">
                                    <iframe width="100%" height="520" frameborder="0" src="https://tradermathematics.carto.com/builder/3f4d7567-a53c-4142-89ca-3f1737b86e52/embed" allowfullscreen webkitallowfullscreen mozallowfullscreen oallowfullscreen msallowfullscreen></iframe>
                                </div>
                                <!-- Earnings (Monthly) Card Example -->
                                <!-- Content Row -->
                                        <div class="d-block d-sm-none">

              <iframe src="https://cdn.plus500.com/Media/Banners/468x60/58345/index.html?set=Coronavirus-Banner&language=EN&country=GB&url=https%3A%2F%2Fwww.plus500.co.uk%2FTrading%2FOptions%3Fid%3D125068%26pl%3D2" width="468" height="60" scrolling="no" frameborder="0" style="border:none"></iframe>
                            </div>
                                 <div id="chartblock" class="row h-100">
                                    <!-- Area Chart -->
                                    <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                        <div class="card shadow mb-2">
                                            <!-- Card Header - Dropdown -->
                                            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                                <h5 class="m-0 font-weight-bold text-primary">Time Series Top 20 Confirmed Countries</h5>
                                            </div><div class="row">
                                                <button class="btn btn-success ml-3 mr-2 mb-2" onclick="addDataset(this)">Add Dataset</button>
                                                <button class="btn btn-danger mb-2" onclick="removeDataset(this)">Remove Dataset</button>
                                            </div>

                                            <form id="dropdown" class="col-md-4">
                                            </form>
                                            <!-- Card Body -->
                                            <div class="card-body col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                                <div>
                                                    <div class="chart-area">
                                                        <canvas id="myChart"></canvas>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <footer class="sticky-footer bg-white">
                            <div class="container my-auto">
                                <div>
                                    Sources:
                                    <a href="https://github.com/CSSEGISandData/COVID-19">John Hopkins University</a>,
                                    <a href="https://www.gov.uk/government/publications/covid-19-track-coronavirus-cases">Public Health England</a>
                                </div>

                                <div class="copyright text-center my-auto">
                                    <span>Copyright &copy; CoronaVirustracker 2019</span>
                                </div>
                            </div>
                        </footer>

                    </div>

                </div>
            </div>
        </div>
    </div>

    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>
</body>
<!-- Bootstrap core JavaScript-->
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
<script src="js/sb-admin-2.min.js"></script>
<script src="vendor/chart.js/Chart.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script src="js/cookies.js"</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-140025504-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-140025504-2');
</script>
<script data-ad-client="ca-pub-5150312524686196" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<script>
    var ctx = document.getElementById("myChart").getContext('2d');
    ctx.canvas.parentNode.style.width = '100%'
    var fdata = <%-timeseriesdata %>
        console.log(fdata)
    var options = [];
    for (var i = 0; i < fdata.length; i++)
        if (fdata[i]['Province-State'] == "N/A") {
            options.push('<option value="' + i + '">' + (fdata)[i]["Country-Region"] + '</option>')
        }
        else { options.push('<option value="' + i + '">' + (fdata)[i]["Country-Region"] + " " + fdata[i]["Province-State"] + '</option>') }
    $('#dropdown').html('<select id="dropdownop"class="form-control select2">' + options.join('') + '</select>');

    var arrlabel = []
    var arrlabels = []
    var arrdata = []

    var myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: Object.keys(fdata[0]['values'][0]),
            datasets: [{
                label: (fdata)[0]["Country-Region"] + " " + fdata[0]["Province-State"],
                data: Object.values(fdata[0]['values'][0]),
                pointBorderColor: "#6495ED",
                borderColor: "#6495ED"
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });
    function addDataset() {
        var colors = ["red", "#7CFC00", "green", "#00FFFF", "#EE82EE", "#e755ba", "#8B008B", "#DAA520", "#D2691E", "#800000", "#FF1493", "#8A2BE2", "#4169E1", "#00BFFF", "#008080", "#00CED1", "#808000"]
        var dropv = $('#dropdownop').val();
        var dropt = $('#dropdownop :selected').text()
        console.log(dropt)

        if (myChart.data.datasets.length < 19) {
            for (i = 0; i < myChart.data.datasets.length; i++) {
                if (dropt == myChart.data.datasets[i].label) {

                    return
                }

            }
            myChart.data.datasets.push({
                label: dropt,
                data: Object.values(fdata[dropv]['values'][0]),
                pointBorderColor: colors[i],
                borderColor: colors[i]
            });
            myChart.update();
        }
    }
    function removeDataset() {
        var dropv = $('#dropdownop').val();
        var dropt = $('#dropdownop :selected').text()

        for (i = 0; i < myChart.data.datasets.length; i++) {
            if (dropt == myChart.data.datasets[i].label) {
                console.log(dropt)
                myChart.data.datasets.splice(i, 1)

            }

        }

        myChart.update();
    }

</script>


<script>
    var x = document.getElementById("locdatadiv");

    function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
        var R = 6371; // Radius of the earth in km
        var dLat = deg2rad(lat2 - lat1);  // deg2rad below
        var dLon = deg2rad(lon2 - lon1);
        var a =
            Math.sin(dLat / 2) * Math.sin(dLat / 2) +
            Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
            Math.sin(dLon / 2) * Math.sin(dLon / 2)
            ;
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        var d = R * c; // Distance in km

        return d;
    }


    function deg2rad(deg) {
        return deg * (Math.PI / 180)
    }

    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            x.innerHTML = "Geolocation is not supported by this browser.";
        }
    }

    function showPosition(position) {

        var locdatai = <%-locdata %>;
        console.log(locdatai)
        var ar = []

        for (i = 0; i < locdatai.length; i++) {
            ar.push(getDistanceFromLatLonInKm(position.coords.latitude, position.coords.longitude, locdatai[i]['Latitude'], locdatai[i]['Longitude']))

        }
        var j = ar.indexOf(Math.min(...ar));


        var lati = position.coords.latitude;
        var longi = position.coords.longitude;
        x.innerHTML = "Country: " + locdatai[j]['Country-Region'] + ", Province: " + locdatai[j]['Province-State'] + ", Confirmed: " + locdatai[j]['Confirmed'] + ", Deaths: " + locdatai[j]['Deaths'] + ", Recovered: " + locdatai[j]['Recovered']
    }

    function showError(error) {
        switch (error.code) {
            case error.PERMISSION_DENIED:
                x.innerHTML = "User denied the request for Geolocation."
                break;
            case error.POSITION_UNAVAILABLE:
                x.innerHTML = "Location information is unavailable."
                break;
            case error.TIMEOUT:
                x.innerHTML = "The request to get user location timed out."
                break;
            case error.UNKNOWN_ERROR:
                x.innerHTML = "An unknown error occurred."
                break;
        }
    }




    getLocation()
</script>

</html>
